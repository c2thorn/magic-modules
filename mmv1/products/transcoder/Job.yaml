# Copyright 2023 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
!ruby/object:Api::Resource
name: "Job"
self_link: "projects/{{project}}/locations/{{location}}/jobs/{{job_id}}"
base_url: "projects/{{project}}/locations/{{location}}/jobs"
create_url: "projects/{{project}}/locations/{{location}}/jobs?jobId={{job_id}}"
update_verb: :PATCH
update_mask: true
description: "Transcoding job resource"
references: !ruby/object:Api::Resource::ReferenceLinks
  guides:
    "Workstations": "https://cloud.google.com/transcoder/docs/"
  api: "https://cloud.google.com/transcoder/docs/reference/rest/v1/projects.locations.jobs"
async: !ruby/object:Api::OpAsync
  operation: !ruby/object:Api::OpAsync::Operation
    path: "name"
    base_url: "{{op_id}}"
    wait_ms: 1000
    timeouts: !ruby/object:Api::Timeouts
      insert_minutes: 30
      update_minutes: 30
      delete_minutes: 30
  result: !ruby/object:Api::OpAsync::Result
    path: "response"
  status: !ruby/object:Api::OpAsync::Status
    path: "done"
    complete: true
    allowed:
      - true
      - false
  error: !ruby/object:Api::OpAsync::Error
    path: "error"
    message: "message"
import_format: ["projects/{{project}}/locations/{{location}}/jobs/{{job_id}}"]
autogen_async: true
examples:
  - !ruby/object:Provider::Terraform::Examples
    name: "job_basic"
    primary_resource_id: "default"
    primary_resource_name: 'fmt.Sprintf("tf-test-job%s", context["random_suffix"])'
    vars:
      job_name: "job"
parameters:
  - !ruby/object:Api::Type::String
    name: "jobId"
    required: true
    immutable: true
    url_param_only: true
    description: |
      ID to use for the Transcoding job.
  - !ruby/object:Api::Type::String
    name: "location"
    immutable: true
    required: true
    url_param_only: true
    description: |
      The location of the transcoding job resource.
properties:
  - !ruby/object:Api::Type::String
    name: "name"
    output: true
    description: |
      The resource name of the job.
  - !ruby/object:Api::Type::String
    name: "inputUri"
    description: |
      Specify the inputUri to populate empty uri fields in each element of Job.config.inputs or JobTemplate.config.inputs when using template.
      URI of the media. Input files must be at least 5 seconds in duration and stored in Cloud Storage (for example, gs://bucket/inputs/file.mp4).
  - !ruby/object:Api::Type::String
    name: "outputUri"
    description: |
      Specify the outputUri to populate an empty Job.config.output.uri or JobTemplate.config.output.uri when using template.
      URI for the output file(s). For example, gs://my-bucket/outputs/.
  - !ruby/object:Api::Type::Time
    name: "createTime"
    description: |
      The time the job was created.
    output: true
  - !ruby/object:Api::Type::Time
    name: "startTime"
    description: |
      The time the transcoding started.
    output: true
  - !ruby/object:Api::Type::Time
    name: "endTime"
    description: |
      The time the transcoding finished.
    output: true
  - !ruby/object:Api::Type::Enum
    name: "state"
    output: true
    description: |
      The current state of the job.
    values:
      - :PROCESSING_STATE_UNSPECIFIED
      - :PENDING
      - :RUNNING
      - :SUCCEEDED
      - :FAILED
  - !ruby/object:Api::Type::Integer
    name: "ttlAfterCompletionDays"
    description: |
      Job time to live value in days, which will be effective after job completion.
      Job should be deleted automatically after the given TTL.
      Enter a value between 1 and 90. The default is 30.
  - !ruby/object:Api::Type::KeyValueLabels
    name: "labels"
    description: |
      The labels associated with this job. You can use these to organize and group your jobs.
  - !ruby/object:Api::Type::NestedObject
    name: "error"
    description: |
      An error object that describes the reason for the failure.
    output: true
    properties:
      - !ruby/object:Api::Type::Integer
        name: "code"
        description: |
          The status code.
      - !ruby/object:Api::Type::String
        name: "message"
        description: |
          A developer-facing error message.
      - !ruby/object:Api::Type::Array
        name: "details"
        description: |
          A list of messages that carry the error details.
  - !ruby/object:Api::Type::Enum
    name: "mode"
    output: true
    description: |
      The processing mode of the job.
    values:
      - :PROCESSING_MODE_UNSPECIFIED
      - :PROCESSING_MODE_INTERACTIVE
      - :PROCESSING_MODE_BATCH
  - !ruby/object:Api::Type::Integer
    name: "batchModePriority"
    description: |
      The processing priority of a batch job. This field can only be set for batch mode jobs.
      The default value is 0. This value cannot be negative. Higher values correspond to higher priorities for the job.
  - !ruby/object:Api::Type::Enum
    name: "optimization"
    output: true
    description: |
      The optimization strategy of the job.
    values:
      - :OPTIMIZATION_STRATEGY_UNSPECIFIED
      - :AUTODETECT
      - :DISABLED
  - !ruby/object:Api::Type::String
    name: "templateId"
    description: |
      Specify the templateId to use for populating Job.config.
      The default is preset/web-hd, which is the only supported preset.

  - !ruby/object:Api::Type::NestedObject
    name: "config"
    description: |
      Runtime host for a workstation.
    properties:
      - !ruby/object:Api::Type::Array
        name: "inputs"
        description: |
          List of input assets stored in Cloud Storage.
        item_type: !ruby/object:Api::Type::NestedObject
          properties:
            - !ruby/object:Api::Type::String
              name: "key"
              description: |
                A unique key for this input. Must be specified when using advanced mapping and edit lists.
            - !ruby/object:Api::Type::String
              name: "uri"
              description: |
                URI of the media. Input files must be at least 5 seconds in duration and stored in Cloud Storage (for example, gs://bucket/inputs/file.mp4).
                If empty, the value is populated from Job.input_uri.
            - !ruby/object:Api::Type::NestedObject
              name: "preprocessingConfig"
              description: |
                Preprocessing configurations.
              properties:
                - !ruby/object:Api::Type::NestedObject
                  name: "color"
                  description: |
                    Color preprocessing configuration.
                  properties:
                    - !ruby/object:Api::Type::Integer
                      name: "saturation"
                      description: |
                        Control color saturation of the video. Enter a value between -1 and 1, where -1 is fully desaturated and 1 is maximum saturation. 0 is no change. The default is 0.
                    - !ruby/object:Api::Type::Integer
                      name: "contrast"
                      description: |
                        Control black and white contrast of the video. Enter a value between -1 and 1, where -1 is minimum contrast and 1 is maximum contrast. 0 is no change. The default is 0.
                    - !ruby/object:Api::Type::Integer
                      name: "brightness"
                      description: |
                        Control brightness of the video. Enter a value between -1 and 1, where -1 is minimum brightness and 1 is maximum brightness. 0 is no change. The default is 0.
                - !ruby/object:Api::Type::NestedObject
                  name: "denoise"
                  description: |
                    Denoise preprocessing configuration.
                  properties:
                    - !ruby/object:Api::Type::Integer
                      name: "strength"
                      description: |
                        Set strength of the denoise. Enter a value between 0 and 1. The higher the value, the smoother the image. 0 is no denoising. The default is 0.
                    - !ruby/object:Api::Type::String
                      name: "tune"
                      description: |
                        Set the denoiser mode. The default is standard.
                - !ruby/object:Api::Type::NestedObject
                  name: "deblock"
                  description: |
                    Deblock preprocessing configuration.
                  properties:
                    - !ruby/object:Api::Type::Integer
                      name: "strength"
                      description: |
                        Set strength of the deblocker. Enter a value between 0 and 1. The higher the value, the stronger the block removal. 0 is no deblocking. The default is 0.
                    - !ruby/object:Api::Type::Boolean
                      name: "enabled"
                      description: |
                        Enable deblocker. The default is false.
                - !ruby/object:Api::Type::NestedObject
                  name: "audio"
                  description: |
                    Audio preprocessing configuration.
                  properties:
                    - !ruby/object:Api::Type::Integer
                      name: "lufs"
                      description: |
                        Specify audio loudness normalization in loudness units relative to full scale (LUFS).
                    - !ruby/object:Api::Type::Boolean
                      name: "highBoost"
                      # TODO: This field is not supported
                      description: |
                        Enable boosting high frequency components. The default is false.
                    - !ruby/object:Api::Type::Boolean
                      name: "lowBoost"
                      # TODO: This field is not supported
                      description: |
                        Enable boosting low frequency components. The default is false.
                - !ruby/object:Api::Type::NestedObject
                  name: "crop"
                  description: |
                    Specify the video cropping configuration.
                  properties:
                    - !ruby/object:Api::Type::Integer
                      name: "topPixels"
                      description: |
                        The number of pixels to crop from the top. The default is 0.
                    - !ruby/object:Api::Type::Integer
                      name: "bottomPixels"
                      description: |
                        The number of pixels to crop from the bottom. The default is 0.
                    - !ruby/object:Api::Type::Integer
                      name: "leftPixels"
                      description: |
                        The number of pixels to crop from the left. The default is 0.
                    - !ruby/object:Api::Type::Integer
                      name: "rightPixels"
                      description: |
                        The number of pixels to crop from the right. The default is 0.
                - !ruby/object:Api::Type::NestedObject
                  name: "pad"
                  description: |
                    Specify the video pad filter configuration.
                  properties:
                    - !ruby/object:Api::Type::Integer
                      name: "topPixels"
                      description: |
                        The number of pixels to add to the top. The default is 0.
                    - !ruby/object:Api::Type::Integer
                      name: "bottomPixels"
                      description: |
                        The number of pixels to add to the bottom. The default is 0.
                    - !ruby/object:Api::Type::Integer
                      name: "leftPixels"
                      description: |
                        The number of pixels to add to the left. The default is 0.
                    - !ruby/object:Api::Type::Integer
                      name: "rightPixels"
                      description: |
                        The number of pixels to add to the right. The default is 0.
                - !ruby/object:Api::Type::NestedObject
                  name: "deinterlace"
                  description: |
                    Specify the video pad filter configuration.
                  properties:
                    - !ruby/object:Api::Type::NestedObject
                      name: "yadif"
                      description: |
                        Specifies the Yet Another Deinterlacing Filter Configuration.
                      properties:
                        - !ruby/object:Api::Type::String
                          name: "mode"
                          description: |
                            Specifies the deinterlacing mode to adopt. The default is send_frame.
                        - !ruby/object:Api::Type::Boolean
                          name: "disableSpatialInterlacing"
                          description: |
                            Disable spacial interlacing. The default is false.
                        - !ruby/object:Api::Type::String
                          name: "parity"
                          description: |
                            The picture field parity assumed for the input interlaced video. The default is auto.
                        - !ruby/object:Api::Type::Boolean
                          name: "deinterlaceAllFrames"
                          description: |
                            Deinterlace all frames rather than just the frames identified as interlaced. The default is false.
                    - !ruby/object:Api::Type::NestedObject
                      name: "bwdif"
                      description: |
                        Bob Weaver Deinterlacing Filter Configuration.
                      properties:
                        - !ruby/object:Api::Type::String
                          name: "mode"
                          description: |
                            Specifies the deinterlacing mode to adopt. The default is send_frame
                        - !ruby/object:Api::Type::String
                          name: "parity"
                          description: |
                            The picture field parity assumed for the input interlaced video. The default is auto.
                        - !ruby/object:Api::Type::Boolean
                          name: "deinterlaceAllFrames"
                          description: |
                            Deinterlace all frames rather than just the frames identified as interlaced. The default is false.
      - !ruby/object:Api::Type::Array
        name: "editList"
        description: |
          List of input assets stored in Cloud Storage.
        item_type: !ruby/object:Api::Type::NestedObject
          properties:
            - !ruby/object:Api::Type::String
              name: "key"
              description: |
                A unique key for this atom. Must be specified when using advanced mapping.
            - !ruby/object:Api::Type::Array
              name: "inputs"
              item_type: Api::Type::String
              description: |
                List of Input.key values identifying files that should be used in this atom. The listed inputs must have the same timeline.
            - !ruby/object:Api::Type::Time
              name: "startTimeOffset"
              description: |
                Start time in seconds for the atom, relative to the input file timeline. The default is 0s.
                A duration in seconds with up to nine fractional digits, ending with 's'. Example: "3.5s".
            - !ruby/object:Api::Type::Time
              name: "endTimeOffset"
              description: |
                End time in seconds for the atom, relative to the input file timeline. When endTimeOffset is not specified, the inputs are used until the end of the atom.
                A duration in seconds with up to nine fractional digits, ending with 's'. Example: "3.5s".

      - !ruby/object:Api::Type::Array
        name: "elementaryStreams"
        description: |
          List of input assets stored in Cloud Storage.
        item_type: !ruby/object:Api::Type::NestedObject
          properties:
            - !ruby/object:Api::Type::String
              name: "key"
              description: |
                A unique key for this atom. Must be specified when using advanced mapping.
            - !ruby/object:Api::Type::Array
              name: "inputs"
              item_type: Api::Type::String
              description: |
                List of Input.key values identifying files that should be used in this atom. The listed inputs must have the same timeline.
            - !ruby/object:Api::Type::Time
              name: "startTimeOffset"
              description: |
                Start time in seconds for the atom, relative to the input file timeline. The default is 0s.
                A duration in seconds with up to nine fractional digits, ending with 's'. Example: "3.5s".
            - !ruby/object:Api::Type::Time
              name: "endTimeOffset"
              description: |
                End time in seconds for the atom, relative to the input file timeline. When endTimeOffset is not specified, the inputs are used until the end of the atom.
                A duration in seconds with up to nine fractional digits, ending with 's'. Example: "3.5s".
